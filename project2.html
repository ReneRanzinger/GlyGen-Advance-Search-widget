<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <style>

    div {
      height: 500px;
      border-color: #777;
      border-width: 1px;
      border-style: solid;
      background-color: #FFFFEE;
      overflow: auto;
    }

    #first{
      width :75.5%;
      float :left;
    }

    #contents{
      width: 24%;
      float: right;
    }

    .node {
        stroke: #fff;
        stroke-width: 2px;
    }

    .link {
        stroke: #999;
        stroke-opacity: 5;
    }
    .gf-content-div{
      border-style: solid;
      color: #2F78B7;
      background-color: #E2E8EF;

    }



    </style>
</head>

<body>

    <div id="first">
    <svg id="mapSVG" width="1000" height="480" viewbox="0 0 1250 580"></svg></div>
    <div id="contents" class = "gf-content-div" width="300" height="400">
      <h3><center>Click on a node to get its properties</center><br></h3>

      <label>Contents of node: </label>
      <p><span id='display'></span></p>
      <form>
      <label><b>Enter a Search Query</b></label>
      <input type="text" name="message" id="user_input">
    </form><br/>
    <input type="submit" onclick=showInput()><br/>

    <p><span id='display2'></span></p>


    </div>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    <script>

var data1;
    $.ajax({
               dataType: "json",
               url: 'data.json',
               success: processData

           });

    function processData(data) {
        console.log(data);
       var collection = {};
       var record;
       alert(data);
  //var nodes = data.nodes;
  var links = data.links;
  var data  = data.data;





}//this is end of ajax
console.log(data1);


        var radius = 15;


        var width = window.innerWidth,
        height = window.innerHeight,
        nodeWidth = 140
        nodeHeight = 35;
        node2Width = 50;
        node2Heigth = (nodeHeight/2);

        //var color = d3.scale.category10();

        var force = d3.layout.force()
        .charge(-1000)
        .linkDistance(100)
        .friction(0.5)
        .size([width, height]);


        var svg = d3.select("#mapSVG")//.append("svg")
        width = +svg.attr("width"),
        height = +svg.attr("height");

      force
        .nodes(d3.values(nodes))
        .links(links)
        .start();
        //Links

      var link = svg.selectAll(".link")
            .data(links)
            .enter()
            .append("g")
            .attr("class", "link")
            .append("polyline")
            //.attr("marker-start", "url(#start)")
            .attr("marker-mid", "url(#end)")
            .style("stroke", linkcolor)
            .style("stroke-width", function(d) {
                return Math.sqrt(d.value);
            });
        //Name of the Links
      var linkText = svg.selectAll(".link")
             .data(links)
             .append("text")
             .attr("class", "link")

             .style("font-size", "13px")
             .style("fill","#000")
             .attr("dy", "1.8em")
             .attr("text-anchor", "middle")
             .text(function(d) {
                  return d.linkName;
               });


//for the main nodes
      var node = svg.selectAll(".node")
        .data(nodes)
        .enter()
        .append("g")
        .on("dblclick", dblclick)
        .attr("transform", function(d) {
            return "translate(" + d.x + "," + d.y + ")";
        })
        .on("click", function(d){
    console.log(d);
    d3.selectAll(".node")
    .style("stroke-width", "0px")
    d3.select(this).select("rect")
    .style("stroke-width", stkwidth)
    var length = d.list.length;

    var data1=d.name+"<br>";
    for(i=0 ; i<length; i++){
    //document.getElementById("contents").innerHTML = d.list[i].accession;

    data1=data1+ "  " +d.list[i].accession +"<br>";
    document.getElementById("display").innerHTML = data1;
}

  });
//appending the node
      node.append("rect")
        .attr("class", "node")
        .attr("width", nodeWidth)
        .attr("height", nodeHeight)
        .attr("rx", 5)
        .attr("ry", 5)
        .attr("fill", function(d) { return (d.nodecol); })
        //.style("fill",linkcolor)
      /*  .style("fill", function(d) {
            return color(d.group);
        })*/
        .style("stroke", "#ffff4d")
        .style("stroke-width", "0px");

//appending text on the main nodes
      node.append("text")
        .text(function(d) {
            return d.name;
        })
        .style("fill", "#fff")
        .style("font-size", "13px")
        .attr("x", (nodeWidth/2))
        .attr("y",(nodeHeight/2))
        .attr("dy", ".35em")
        .attr("text-anchor", "middle")
        node.append("title")
            .text(function(d) {
            return d.name;
        });

        //the code for the numeric nodes


          var value = document.getElementById("user_input").value;
          var result = "result_type";
          var json = JSON.stringify({result_type:"count"});
          console.log(json);
          var settings = {
            "url": "http://127.0.0.1:5000/commonSearch",
            "method": "POST",
            "headers": {
              "Content-Type": "application/json"
            },
            "data": json
          }
        console.log("hello")
          $.ajax(settings).done(function (response) {
        console.log(response);







          var values  = response.values;
          console.log(values);
        var numnodes = svg.selectAll(".numnodes")
        .data(nodes)
        .enter()
        .append("g")
        //.on("mouseover", mouseover)
        //.on("mouseout",mouseout)
        .attr("transform", function(d) {
            return "translate(" + ((d.x)+2.3*node2Width) +"," + ((d.y)-0.5*node2Heigth) + ")";
        });

        numnodes.append("rect")
        .attr("class",numnodes)
        .attr("width", node2Width)
        .attr("height", node2Heigth)
        .attr("rx", 5)
        .attr("ry", 5)
        .attr("fill","#fff")
        .style("stroke","#0F9D58")
        .style("stroke-width",stkwidth2)

//appending text on numeric nodes
        numnodes.append("text")
        .data(values)

          .text(function(d) {


            return d.values;
          })
          .style("fill", "#000")
          .style("font-family","Tahoma")
          .style("font-size", "11px")
          .style("font-style","normal")
          .attr("x", node2Width/2)
          .attr("y", node2Heigth/2)
          .attr("dy", "0.35em")

        .attr("text-anchor", "middle");

          numnodes.append("title")
              .text(function(d) {
              return d.name;
          });

});//end of ajax for ws


        // build the arrow.

        svg.append("svg:defs").selectAll("marker")
        .data(["end"])      // Different link/path types can be defined here
        .enter().append("svg:marker")    // This section adds in the arrows
        .attr("id", String)
        .attr("viewBox", "2 -5 10 10")
        .attr("refX", 0)
        .attr("refY", 0)
        .attr("markerWidth", 6)
        .attr("markerHeight",8)
        .attr("orient", "auto")
        .append("svg:path")
        .attr("d", "M0,-5L10,0L0,5");


      /*force.on("tick", function() {
        link.attr("x1", function(d) {
                return d.source.x + (nodeWidth / 2);
            })
            .attr("y1", function(d) {
                return d.source.y + (nodeHeight / 2);
            })
            .attr("x2", function(d) {
                return d.target.x + (nodeWidth / 2);
            })
            .attr("y2", function(d) {
                return d.target.y + (nodeHeight / 2);
            });*/

            force.on("tick", function() {
            link.attr("points", function(d) {
            return (d.source.x+(nodeWidth / 2)) + "," + (d.source.y+(nodeHeight / 2)) + " " +
            ((d.target.x+ d.source.x+nodeWidth)/2) + "," + ((d.target.y+ d.source.y+nodeHeight)/2) +" "+
            (d.target.x+(nodeWidth / 2)) + "," + (d.target.y+(nodeHeight / 2)); });

        node.attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });



            linkText
                    .attr("x", function(d) {
                        return ((d.source.x + d.target.x)/1.72);
                    })
                    .attr("y", function(d) {
                        return ((d.source.y + d.target.y)/1.96);
                    });


});
      function mouseover() {
        d3.select(this).select("rect").transition()
          .duration(750)
          .attr("width", 70)
          .attr("height", 25);
          d3.select(this).select("text").transition()
          .duration(750)
          .style("fill", "#000")
          .attr("x", 35)
          .attr("y", 2)
          .style("font-size", "14px");

      }

      function mouseout() {
        d3.select(this).select("rect").transition()
          .duration(750)
          .attr("width", 50)
          .attr("height", 15)
          .style("stroke-width", "1.5px");
          d3.select(this).select("text").transition()
          .duration(750)
          .style("fill", "#000")
          .attr("x", 25)
          .attr("y", 0)
          .style("font-size", "11px");
      }





    /*  function onClick(){
        document.getElementById("contents").textContent =
        graph.nodes["8"].list[1].accession;
      }*/

      function linkcolor(d){
        if(d.group == "1"){
          return "#2B60DE";
        }
        else {
          return "red";
        }
      }

      function txtcolor(d){
        if(d.group == "1"){
          return "#2B60DE";
        }
        else {
          return "red";
        }
      }


      function dblclick() {
        d3.select(this).select("rect").transition()
        .style("stroke-width", "0px");
      }
//for regular nodes
      function stkwidth(d){
        if(d.group == "1"){
          return "3px";
        }
        else{
          return "0px";
            }
      }
//for numeric nodes
      function stkwidth2(d){
        if(d.group == "1"){
          return "1.5px";
        }
        else{
          return "0px";
            }
      }








    </script>
  </div>
</body>




</html>
